<!DOCTYPE html>
<html>
  <head>
    <title>ログインチェック</title>
    <style>
      
    </style>
  </head>
  <body>
    <div id=tokenlog></div>
    <div id=log>ログイン情報を取得中...</div>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        const element = document.getElementById("log");
        const element2 = document.getElementById("tokenlog");
        try {
          const tokentest = localStorage.getItem("authToken");
        } catch( e ) {
          element2.innerText = "トークンの取得に失敗しました"
          return false;
        }
        const token = localStorage.getItem("authToken");
        element2.innerText = `トークンの取得に成功しました: ${token}`
        fetch("https://api.hatena-scratch.f5.si/auth/check", {
          method: "GET",
          headers: {
            "Authorization": `Bearer ${token}`, // トークンをヘッダーに含める
            "Content-Type": "application/json"
          }
        })
          .then(response => response.json())
          .then(data => {
            if (data.isAuthenticated) {
              element.innerText = '認証成功:${data.user}';
            } else {
              element.innerText = "認証失敗";
            }
          })
          .catch(error => element.innerText = "エラー:", error)      });
    </script>
  </body>
</html>
