<!DOCTYPE html>
<html>
<head>
    <title>ログインチェック</title>
    <style></style>
</head>
<body>
    <div id="tokenlog"></div>
    <div id="token1"></div>
    <div id="log">ログイン情報を取得中...</div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const element = document.getElementById("log");
            const element2 = document.getElementById("tokenlog");
            const element3 = document.getElementById("token1");
            const element4 = document.getElementById("token2");
            try {
                const tokentest = localStorage.getItem("authToken");
            } catch (e) {
                element2.innerText = "トークンの取得に失敗しました";
                return;
            }
            const token = localStorage.getItem("authToken");
            element2.innerText = `トークンの取得に成功しました: ${token}`;
            const base64Url = token.split('.')[1]; // トークンのペイロード部分
            const payload = JSON.parse(atob(base64Url));
            element3.innerText = JSON.stringify(payload);
            const currentTime = Math.floor(Date.now() / 1000); // 現在のUnixタイムスタンプ
            const expTime = payload.exp; // expの値を取得
            const resultElement = document.getElementById('result');
            if (currentTime < expTime) {
            element4.innerText = "トークンは有効です。";
            } else {
            element4.innerText = "トークンは無効です。";
            }

            fetch("https://api.hatena-scratch.f5.si/auth/check", {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${token}`, // トークンをヘッダーに含める
                    "Content-Type": "application/json"
                }
            })
          .then(response => response.json())
          .then(data => {
            if (data.isAuthenticated) {
              element.innerText = '認証成功:${data.user}';
            } else {
              element.innerText = "認証失敗";
            }
          })
          .catch(error => element.innerText = "エラー:", error)      });
    </script>
  </body>
</html>
